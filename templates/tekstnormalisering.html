{% extends "base.html" %}

{% block title %}Arkivnummer-normalisering - DGB V√¶rkt√∏jer{% endblock %}

{% block content %}
    <h1>Arkivnummer-normalisering</h1>
    <p class="muted">V√¶lg fanen <b>Tekst</b> eller <b>Excel</b> herunder. Regler:
      <span class="pill">":" ‚Üí 5 cifre f√∏r kolon (bogstaver t√¶ller ikke)</span>
      <span class="pill">"x/X" ‚Üí 4 cifre p√• hver side</span>
    </p>

    <div class="tabs">
      <div class="tab"><a href="{{ url_for('tekstnormalisering.view', tab='text') }}" class="{{ 'active' if tab=='text' else '' }}">Tekst</a></div>
      <div class="tab"><a href="{{ url_for('tekstnormalisering.view', tab='excel') }}" class="{{ 'active' if tab=='excel' else '' }}">Excel</a></div>
    </div>

    {% if tab == 'text' %}
    <div class="card">
      <h2>Tekst</h2>
      <form method="post" action="{{ url_for('tekstnormalisering.view', tab='text') }}">
        <div class="row">
          <div class="col">
            <label for="inp">Inds√¶t numre her:</label>
            <textarea id="inp" name="inp" rows="10" placeholder="√ât pr. linje eller adskilt med mellemrum/komma/semikolon">{{ inp or '' }}</textarea>
          </div>
          <div class="col">
            <div><span class="muted">Tip: Inds√¶t r√• data til venstre og klik <b>Normalis√©r</b>.</span></div>
          </div>
        </div>
        <div class="spacer"></div>
        <button type="submit">Normalis√©r</button>
      </form>
    </div>

    {% if tokens is not none %}
    <div class="card">
      <h3>Resultat (√©n pr. linje)</h3>
      <textarea rows="10" readonly>{{ normalized | join('\n') }}</textarea>
    </div>
    <div class="card">
      <h3>Opslag (f√∏r ‚Üí efter)</h3>
      <textarea rows="10" readonly>{% for a,b in pairs %}{{ a }} ‚Üí {{ b }}
{% endfor %}</textarea>
    </div>
    <div class="card">
      <h3>üîé SARA-s√∏gning</h3>
      <textarea rows="4" readonly>{{ sara_query }}</textarea>
    </div>
    {% endif %}
    {% endif %}

    {% if tab == 'excel' %}
    <div class="card">
      <h2>Excel</h2>
      <form method="post" action="{{ url_for('tekstnormalisering.view', tab='excel') }}" enctype="multipart/form-data">
        <div class="row">
          <div class="col">
            <label for="excel">Upload Excel-fil (.xlsx/.xls)</label>
            <input type="file" id="excel" name="excel" accept=".xlsx,.xls" />
          </div>
          <div class="col">
            <label for="add_mapping">Ekstra "Mapping"-ark (f√∏r/efter)?</label>
            <select id="add_mapping" name="add_mapping">
              <option value="yes" {% if add_mapping=='yes' %}selected{% endif %}>Ja</option>
              <option value="no" {% if add_mapping=='no' %}selected{% endif %}>Nej</option>
            </select>
          </div>
        </div>
        <div class="spacer"></div>
        <button type="submit">Normalis√©r Excel</button>
      </form>
      <p class="muted">Vi l√¶ser f√∏rste ark og g√¶tter en relevant kolonne (kan √¶ndres i n√¶ste trin, hvis n√∏dvendigt).</p>        
    </div>

    {% if preview is not none %}
      <div class="card">
        <h3>Forh√•ndsvisning (f√∏r)</h3>
        {{ preview|safe }}
      </div>

      {% if guessed_col %}
      <div class="card">
        <div class="success">Foresl√•et kolonne: <b>{{ guessed_col }}</b></div>
      </div>
      {% else %}
      <div class="card">
        <div class="alert">Kunne ikke g√¶tte kolonne ‚Äì vi brugte f√∏rste kolonne i arket.</div>
      </div>
      {% endif %}

      <div class="card">
        <form method="post" action="{{ url_for('tekstnormalisering.download') }}">
          <input type="hidden" name="payload_token" value="{{ payload_token }}" />
          <button type="submit">‚¨áÔ∏è Download opdateret Excel</button>
        </form>
        <p class="muted">Den downloadede fil indeholder en ny kolonne med normaliserede v√¶rdier{% if add_mapping=='yes' %} og et ekstra "Mapping"-ark{% endif %}.</p>
      </div>
    {% endif %}
    {% endif %}

{% endblock %}